# src: https://github.com/invoiceninja/dockerfiles/blob/master/docker-compose.yml
# uses a submodule in ./source
version: "3.7"
services:
  server:
    image: nginx
    restart: always
    env_file:
      - .env
    volumes:
      - ./config/nginx/in-vhost.conf:/etc/nginx/conf.d/in-vhost.conf:ro
      - ninja-public:/var/www/app/public:ro
    depends_on:
      - app
    ports:
      - 8084:80
    networks:
      - invoiceninja
    extra_hosts:
      - "in5.localhost:192.168.0.124 "
  app:
    image: invoiceninja/invoiceninja:latest
    restart: always
    env_file:
      - .env
    depends_on:
      - db
    volumes:
      - ./config/hosts:/etc/hosts:ro
      - ./config/php/php.ini:/usr/local/etc/php/php.ini
      - ./config/php/php-cli.ini:/usr/local/etc/php/php-cli.ini
      - ninja-public:/var/www/app/public:rw,delegated
      - ninja-storage:/var/www/app/storage:rw,delegated
    extra_hosts:
      - "in5.localhost:192.168.0.124 "
    networks:
      - invoiceninja
  db:
    image: mariadb:latest
    ports:
      - 3305:3306
    restart: always
    env_file:
      - .env
    volumes:
      - mariadb-data:/var/lib/mysql:rw,delegated
    networks:
      - invoiceninja
    extra_hosts:
      - "in5.localhost:192.168.0.124 " #host and ip
networks:
  invoiceninja: null
volumes:
  mariadb-data:
    driver: local
  ninja-public:
    driver: local
  ninja-storage:
    driver: local